# 리버싱 핵심원리

## Process Explorer
- 일종의 작업관리자 확장판
- 실행 중인 프로세스의 정보들을 표시 ( 트리 구조, cpu 점유율 등)
- 상세한 내용이 나와있음
- 프로세스의 상태를 색깔로 표시
- 파란색 - 정상적으로 작동
- 정보 요약
- Virus total 과 연계 가능
- 악성코드 세부적 분석 전에 겉으로 훑어볼때 쓰는 용도
- DLL/Handle 정보 표시 및 검색
- 프로세스 중지 재개 재시작 종료 기능

- 밑에 보면 어떤 dll을 쓰는지 나와있음
  
## Calling Convention
- 함수 호출 교약
    - 파라미터 전달방식에 대한 약속
    - 스택을 통해 전달
    - 함수 호출 후 ESP를 어떻게 정리하는 지에 대한 약속!
    - 주요 규약
        - cdecl
            - 주로 C언어 사용 방식
            - Caller 함수 호출자에서 스택을 정리
            - 인자 전달 순소 오른쪽->왼쪽
            - Caller가 자신이 스택에 입력한 파라미터를 직접 정리하기 때문에
            - 가변 길이 파라미터 사용 가능 (printf)
        - stdcall
        - fastcall
            - 기본적으로 stdcall 방식과 비슷함
            - 파라미터를 2개까지 레지스터 (ECX,EDX) 사용
            - 좀 더 빠른 호출
            - 레지스터 관리 오버헤드 가능성
            - 인자 전달 순서 R to L
            - Callee 함수 피호출자가 스택을 정리
- 스택
    - 프로세스에서 정의된 메모리 공간
    - 아래 방향으로 자람
    - PE헤더에 그 크기가 명시되어 있음
    - 프로세스 실행될 때 스택 메모리 크기가 결정됨

- 함수 실행 완료 후
    - 파라미터
        - 스택에 저장된 값은 임시 사용 값
        - 값을 지우거나 하면 불필요한 cpu 자원 소모
        - 메모리 해제 불가 및 필요없음
    - ESP(스택 포인터)
        - 함수 호출 전으로 복원(참조 가능 스택 크기 유지)
## Lena's Reversing
목표
1. Message box 제거
    - MSVBM50.rtcMsgBox 
    - 메세지 박스가 호출되는 걸 건너뛰거나 안나오게
    - 상위 함수호출에서 호출을 못하게
    - 아니면 rtcMsgBox에서 바로 리턴하게
2. Registration code 찾기
    - Registration code를 알아내는 걸로 ( 우회는 허용 안함 )
CALL 명령어 크기는 5바이트
ADD ESP,14
MOV EAX,1 -> 명령어 길이가 8바이트, 코드 침범!
